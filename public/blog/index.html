
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Reza Jatnika</title>
  <meta name="author" content="Reza Jatnika">

  
  <meta name="description" content="A nice quote by Tywin Lannister taken from A Storm of Sword book. The greatest fools are ofttimes more clever then the men who laugh at them.Tywin &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://reza.re/blog">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Reza Jatnika" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35741909-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Reza Jatnika</a></h1>
  
    <h2>stuff and etc</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:reza.re" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/aboutme/">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/tywin-lannister-quote/">Tywin Lannister Quote</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-15T09:28:00+07:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A nice quote by Tywin Lannister taken from <em>A Storm of Sword</em> book.</p>

<blockquote><p>The greatest fools are ofttimes more clever then the men who laugh at them.</p><footer><strong>Tywin Lannister</strong> <cite>A Storm of Swords</cite></footer></blockquote>

</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/deploying-octopress-slash-jekyll-on-appfog/">Deploying Octopress/Jekyll on AppFog</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-15T04:55:00+07:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Deploying Jekyll or Octopress based website to Heroku is really easy and simple, because Heroku use git for source code management. Heroku will create automatically our server based on our type of application, but we can&rsquo;t choose server location. With AppFog we can choose nearest server from our location. I live in Indonesia, so the nearest infrastucture is AWS Singapore. We can have very little response time compared to Heroku.</p>

<h2>Preparation</h2>

<p>Deploying to AppFog is not as easy as deploying to Heroku. We need to configure Octopress. Before that, lets install af gem. It&rsquo;s similar to heroku gem.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem install af</span></code></pre></td></tr></table></div></figure>


<p>After installing af gem, go to our Octopress directory. Login to AppFog by running the following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ af login</span></code></pre></td></tr></table></div></figure>


<p>Create an <code>app.rb</code> file to handle <code>SinatraStaticServer</code> class.</p>

<figure class='code'><figcaption><span>app.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler/setup&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The project root directory</span>
</span><span class='line'><span class="vg">$root</span> <span class="o">=</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span><span class="p">(</span><span class="sr">/.+/</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">send_sinatra_file</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span><span class="mi">404</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">not_found</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">send_file</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="s1">&#39;404.html&#39;</span><span class="p">),</span> <span class="p">{</span><span class="ss">:status</span> <span class="o">=&gt;</span> <span class="mi">404</span><span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">send_sinatra_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">missing_file_block</span><span class="p">)</span>
</span><span class='line'>    <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="n">file_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span> <span class="k">unless</span> <span class="n">file_path</span> <span class="o">=~</span> <span class="sr">/\.[a-z]+$/i</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="p">?</span> <span class="n">send_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="p">:</span> <span class="n">missing_file_block</span><span class="o">.</span><span class="n">call</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create <code>.afignore</code>, it&rsquo;s similar to <code>.gitignore</code> in git.</p>

<figure class='code'><figcaption><span>.afignore </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Local config
</span><span class='line'>config.ru
</span><span class='line'>
</span><span class='line'>.sass-cache/
</span><span class='line'>.gist-cache/
</span><span class='line'>.pygments-cache/
</span><span class='line'>
</span><span class='line'>.themes/
</span><span class='line'>
</span><span class='line'>.gitignore
</span><span class='line'>.gitattributes</span></code></pre></td></tr></table></div></figure>


<p>We include <code>config.ru</code> because we already have <code>app.rb</code> to handle Sinatra.</p>

<h2>Deploying</h2>

<p>We can create new AppFog app by using website or directly from command line.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ af push --runtime ruby193</span></code></pre></td></tr></table></div></figure>


<p>Choose Sinatra application not Rack application. Save the configuration file, it&rsquo;s looks like this.</p>

<figure class='code'><figcaption><span>manifest.yml </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">applications</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">.</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rezare</span>
</span><span class='line'>    <span class="l-Scalar-Plain">framework</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sinatra</span>
</span><span class='line'>      <span class="l-Scalar-Plain">info</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">mem</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">128M</span>
</span><span class='line'>        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Sinatra Application</span>
</span><span class='line'>        <span class="l-Scalar-Plain">exec</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">infra</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ap-aws</span>
</span><span class='line'>    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">${name}.${target-base}</span>
</span><span class='line'>    <span class="l-Scalar-Plain">mem</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">512M</span>
</span><span class='line'>    <span class="l-Scalar-Plain">instances</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>To update our application run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git add .
</span><span class='line'>$ git commit -m "Site updated"
</span><span class='line'>$ af update</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>Using AppFog for deploying Octopress is slightly different than Heroku, but it&rsquo;s offer better response time. AppFog do not use source code management, but we can use GitHub or bitbucket to store our website code. And one more thing, we can not use custom domain on free plans.</p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/intel-big-data-101/">Intel Big Data 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-14T06:55:00+07:00" pubdate data-updated="true">Jun 14<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Intel Big Data 101: How Big Data Makes Big Impacts</h2>

<iframe width="640" height="360" src="http://www.youtube.com/embed/D4ZQxBPtyHg?feature=player_detailpage" frameborder="1" allowfullscreen></iframe>

</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/improving-octopress-performance/">Improving Octopress Performance</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-13T12:08:00+07:00" pubdate data-updated="true">Jun 13<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is how I improving octopress website based, it&rsquo;s covers Cloudflare DNS/CDN management and configuration of heroku and sinatra.</p>

<h2>DNS and CDN Management</h2>

<p>CloudFlare is more than just a DNS, their service includes a CDN, page acceleration, security checking, DDOS protection, and more. However, you can switch all that off and just use their DNS. They delivered marginally the best performance. In terms of pricing, if you don’t need SSL, it’s free; if you do need SSL, then your first site is $240 per year, subsequent sites $60 per year.</p>

<p>My example sites:</p>

<ul>
<li><a href="http://reza.re">reza.re</a> &ndash; Cloudflare + CDN</li>
<li><a href="http://direct.reza.re">direct.reza.re</a> &ndash; Cloudflare</li>
</ul>


<h2>Heroku and Sinatra</h2>

<p> The default configuration for Octopress and Heroku is to use Sinatra, which in turn means that Heroku will serve your traffic using Webrick. The result is one Heroku instance running one web server. If you use Unicorn, you can get multiple instances running within it; in the configuration described below, this results in four times the capacity.</p>

<p>Add Unicorn to the <code>Gemfile</code> outside of the development group:</p>

<figure class='code'><figcaption><span>Gemfile </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s2">&quot;http://rubygems.org&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># all default gems</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;sinatra&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.4.2&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;unicorn&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add a <code>unicorn.rb</code> file in the root directory of your application:</p>

<figure class='code'><figcaption><span>unicorn.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">worker_processes</span> <span class="mi">4</span>
</span><span class='line'><span class="n">timeout</span> <span class="mi">30</span>
</span><span class='line'><span class="n">preload_app</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add a <code>Procfile</code> file in the root directory of your application:</p>

<figure class='code'><figcaption><span>Procfile </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">web</span><span class="p">:</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">unicorn</span> <span class="o">-</span><span class="nb">p</span> <span class="vg">$PORT</span> <span class="o">-</span><span class="n">c</span> <span class="o">.</span><span class="n">/unicorn</span><span class="o">.</span><span class="n">rb</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it. You can test your website performance score using <a href="https://developers.google.com/speed/pagespeed/insights#">Google PageSpeed</a> and see suggestion summary.</p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/new-blog/">New Blog</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-02T00:32:00+07:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>New blog!</p>

<p><img src="https://dl.dropboxusercontent.com/u/146649182/reza.re/newblog.jpg"></p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/single-user-rvm/">Single User RVM</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-05T00:32:00+07:00" pubdate data-updated="true">Nov 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Using RVM we can manage multiple Ruby version along with it&rsquo;s gemsets. Installing RVM for single user is very easy, especially on Ubuntu. Install <code>build-essential</code> and <code>git-core</code> package.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install build-essential git git-core curl
</span><span class='line'>$ bash</span></code></pre></td></tr></table></div></figure>


<p>Next, install RVM using <code>curl</code> from the terminal.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -L https://get.rvm.io | bash -s stable</span></code></pre></td></tr></table></div></figure>


<p>Add these following line into <code>bashrc</code> file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo '[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"' >> ~/.bashrc
</span><span class='line'>$ . .bashrc</span></code></pre></td></tr></table></div></figure>


<p>To test if our installation of RVM was succesfull, we can run a command and check its output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ type rvm | head -1
</span><span class='line'>rvm is a function</span></code></pre></td></tr></table></div></figure>


<p>If the output of the above command is equivalent to rvm is a function, then we now have a working RVM installation. To install additional RVM dependencies, run the following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rvm requirements</span></code></pre></td></tr></table></div></figure>


<p>Now we have fully working RVM with dependencies. Now we can install Ruby using RVM command.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rvm install 1.9.3
</span><span class='line'>$ rvm use 1.9.3 --default</span></code></pre></td></tr></table></div></figure>



</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/host-rails-application-with-nginx-and-passenger/">Hosting Rails Applications on Nginx</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-13T01:18:13+07:00" pubdate data-updated="true">Oct 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hosting and deploying Ruby on Rails application became very easy with <a href="http://www.modrails.com/">Phusion Passenger</a> or <code>mod_rails</code>. Phusion Passenger is an nginx module, which makes deploying Ruby and Ruby on Rails applications on nginx a breeze. This guide describes the required process for deploying Ruby on Rails with Passenger and the nginx web server on CentOS 6. Assume we have installed nginx and Ruby on Rails.</p>

<h2>Install Nginx with Phusion Passenger</h2>

<p>First, install the Phusion Passenger gem by running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gem install passenger</span></code></pre></td></tr></table></div></figure>


<p>Next, run the Phusion Passenger installer for nginx:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># passenger-install-nginx-module</span></code></pre></td></tr></table></div></figure>


<p>When promted, choose &ldquo;1&rdquo; to allow the installer to automatically download, compile, and install nginx on the system (on <code>opt</code> folder by default). Because we have installed nginx before, copy <code>/opt/nginx/sbin/nginx</code> to <code>/usr/sbin/</code>. If nginx daemon are running, stop it first.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># /etc/init.d/nginx stop
</span><span class='line'># cp /opt/sbin/nginx /usr/sbin/</span></code></pre></td></tr></table></div></figure>


<p>Now, we have a new nginx binary with Passenger support without changing any existing configurations. To enable Passenger support, add these lines to <code>/etc/nginx/nginx.conf</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http {
</span><span class='line'>  ...
</span><span class='line'>  passenger_root /usr/local/rvm/gems/ruby-1.9.3-p194/gems/passenger-3.0.17;
</span><span class='line'>  passenger_ruby /usr/local/rvm/wrappers/ruby-1.9.3-p194/ruby;
</span><span class='line'>  ...</span></code></pre></td></tr></table></div></figure>


<p>To see Ruby path:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># which ruby</span></code></pre></td></tr></table></div></figure>


<p>Passenger root folder usually lies in <code>/yourruby/gems/passenger-x.x.x</code>. Even the installation will recognize your Ruby and Passenger location, it&rsquo;s good the check it manually.</p>

<h2>Hosting Rails Application</h2>

<p>As I mentioned before, hosting Rails applications became very simple with Passenger. As simple as creating a new virtual host. Create a new configuration files, for example <code>railsapp.example.org.conf</code> in <code>/etc/nginx/conf.d/</code>, add these lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server {
</span><span class='line'>  listen 80;
</span><span class='line'>  server_name railsapp.example.org;
</span><span class='line'>  passenger_enabled on;
</span><span class='line'>  passenger_use_global_queue on;
</span><span class='line'>  root /path/to/railsapp/public;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Start nginx to reload new configurations.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># /etc/init.d/nginx start</span></code></pre></td></tr></table></div></figure>


<p>For detailed guides see <a href="http://www.modrails.com/documentation/">Passenger documentation</a>.</p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/initial-vps-setup/">Initial Virtual Private Server Setup</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-11T04:21:34+07:00" pubdate data-updated="true">Oct 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is initial setup for my CentOS 6.3 virtual private server. I want to use it for deploying Rails application and hosting my website. This article only cover basic installation for web server, Ruby with RVM, Rails, and crontab.</p>

<h2>Preparation</h2>

<p>I will use <a href="http://server.example.org/">server.example.org</a> as my VPS hostname. I will not install DNS server to save some physical memory on VPS. On the DNS registrar management create address record or <code>A</code> record for server and point it to the VPS public ip address. Access VPS via SSH or <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">putty</a> if using Windows.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[reza@local ~]$ ssh root@server.example.org</span></code></pre></td></tr></table></div></figure>


<p>As usual, run update after OS installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# yum -y update</span></code></pre></td></tr></table></div></figure>


<p>By default, the VPS comes with Apache HTTP web server, but I will use <a href="http://nginx.org/">nginx</a> for my web server. Removing Apache web server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# yum remove httpd</span></code></pre></td></tr></table></div></figure>


<p>To add nginx yum repository, create a file named <code>/etc/yum.repos.d/nginx.repo</code> and paste the configuration below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[nginx]
</span><span class='line'>name=nginx
</span><span class='line'>baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
</span><span class='line'>gpgcheck=0
</span><span class='line'>enabled=1</span></code></pre></td></tr></table></div></figure>


<p>Install nginx using yum:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# yum update
</span><span class='line'>[root@server ~]# yum install nginx</span></code></pre></td></tr></table></div></figure>


<p>Start nginx daemon and add link to system startup:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# /etc/init.d/nginx start
</span><span class='line'>[root@server ~]# chkconfig --levels 235 nginx on</span></code></pre></td></tr></table></div></figure>


<p>See <a href="http://server.example.org/">server.example.org</a> to check nginx installation.</p>

<h2>Development Tools and Git</h2>

<p>Install development tools for RubyGems dependencies:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# yum groupinstall 'Development Tools'
</span><span class='line'>[root@server ~]# yum install zlib zlib-devel sqlite-devel libffi-devel openssl-devel readline-devel</span></code></pre></td></tr></table></div></figure>


<p>Install git for source code management:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# yum install git-core</span></code></pre></td></tr></table></div></figure>


<h2>Ruby with RVM</h2>

<p>Before install Ruby Version Manager or <a href="https://rvm.io/rvm/">RVM</a> via <code>curl</code> command, we need to install <code>libyaml-devel</code> to prevent psych error. Add new yum repository from <a href="http://repoforge.org/use/">repoforge.org</a>, then install <code>libyaml-devel</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# yum install libyaml-devel</span></code></pre></td></tr></table></div></figure>


<p>Next, we can install RVM without any trouble.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# curl -L https://get.rvm.io | bash -s stable
</span><span class='line'>[root@server ~]# bash</span></code></pre></td></tr></table></div></figure>


<p>Using RVM we can install many Ruby version, see <a href="https://rvm.io/rvm/install/">RVM docs</a> for detailed instructions. For now, I just need Ruby 1.9.3, to install this version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# rvm install 1.9.3
</span><span class='line'>[root@server ~]# rvm use 1.9.3 --default</span></code></pre></td></tr></table></div></figure>


<p>To check Ruby and RubyGems installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# ruby -v
</span><span class='line'>ruby 1.9.3p194 (2012-04-20 revision 35410) [i686-linux]
</span><span class='line'>[root@server ~]# gem -v
</span><span class='line'>1.8.24</span></code></pre></td></tr></table></div></figure>


<p>With Ruby and RubyGems loaded, you can install all of <a href="http://rubyonrails.org/">Rails</a> and its dependencies (approximately 29 gems) through the command line:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# gem install rails</span></code></pre></td></tr></table></div></figure>


<h2>Crontab</h2>

<p>I will use <a href="http://crontab.org/">crontab</a> for automatic update once a week. Create a shell script <code>/etc/cron.weekly/yum.sh</code> and add script below:</p>

<figure class='code'><figcaption><span>yum.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">YUM</span><span class="o">=</span>/usr/bin/yum
</span><span class='line'><span class="nv">$YUM</span> -y -R 120 -d 0 -e 0 update yum
</span><span class='line'><span class="nv">$YUM</span> -y -R 10 -e 0 -d 0 update
</span></code></pre></td></tr></table></div></figure>


<p>Make sure you setup executable permission:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@server ~]# chmod +x /etc/cron.weekly/yum.sh</span></code></pre></td></tr></table></div></figure>


<p>Using crontab, we can schedule jobs (commands or shell scripts) to run periodically at certain times or dates, see <a href="http://en.wikipedia.org/wiki/Cron">wiki page</a> for further reading.</p>
</div>
  
  

</article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Reza Jatnika -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rezare';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
